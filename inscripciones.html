
            const handleDeleteSingle = async (cid) => {
                setDeletingCourseId(cid);
                try {
                    const c = existingCourses.find(x => x.id === cid);
                    const response = await fetch(CONFIG.APPS_SCRIPT_URL, {
                        method: 'POST', body: JSON.stringify({
                            action: 'cancelSingle', curp: formData.curp, email: formData.email, fullName: formData.fullName,
                            courseToCancel: { id: c.id, name: c.name }
                        })
                    });
                    
                    const json = await response.json();
                    
                    if (json.success) {
                        let msg = `El curso "${c.name}" ha sido dado de baja exitosamente.`;
                        
                        if (json.emailSent) {
                             msg += `\n\nSe ha enviado un comprobante de cancelación a tu correo (${formData.email}).`;
                        } else {
                             msg += `\n\n⚠️ AVISO: El sistema NO pudo enviar el correo de confirmación. Por favor verifica en tu Historial de Cursos que la baja se haya procesado.`;
                        }

                        alert(msg);
                        
                        // CORRECCIÓN: Actualizar el estado local en lugar de redirigir
                        const updatedCourses = existingCourses.filter(course => course.id !== cid);
                        setExistingCourses(updatedCourses);
                        setOriginalSelectedCourses(updatedCourses);

                        // Si ya no quedan cursos, cerramos el modal automáticamente
                        if (updatedCourses.length === 0) {
                            setIsModalOpen(false);
                        }
                    } else {
                        throw new Error(json.message || "Error al cancelar");
                    }

                } catch(e) { 
                    alert("Error al cancelar: " + e.message); 
                } finally {
                    setDeletingCourseId(null);
                }
            };
