<!DOCTYPE html>
<html lang="es">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>Inscripciรณn a Cursos - ITD</title>
ย ย <meta name="description" content="Inscrรญbete a los cursos de actualizaciรณn docente del Instituto Tecnolรณgico de Durango. Consulta la oferta acadรฉmica, selecciona tus cursos y regรญstrate en lรญnea.">
ย ย <meta name="keywords" content="inscripciones ITD, cursos ITD, registro cursos, actualizaciรณn docente, TecNM Durango">
ย ย
ย ย <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/DA-itd/web/main/logo_itdurango.png">
ย ย
ย ย <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
ย ย <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
ย ย <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
ย ย <script src="https://cdn.tailwindcss.com"></script>

ย ย ย ย <style>
ย ย ย ย .modal {
ย ย ย ย ย ย position: fixed;
ย ย ย ย ย ย top: 0;
ย ย ย ย ย ย left: 0;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย height: 100%;
ย ย ย ย ย ย background-color: rgba(0, 0, 0, 0.5);
ย ย ย ย ย ย display: none; /* Inicia oculto, JS lo muestra */
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย z-index: 1000;
ย ย ย ย }
ย ย ย ย .modal-content {
ย ย ย ย ย ย background: white;
ย ย ย ย ย ย padding: 20px;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย max-width: 90%;
ย ย ย ย ย ย max-height: 90%;
ย ย ย ย ย ย overflow-y: auto;
ย ย ย ย }
ย ย ย ย /* Clase para cursos marcados para cancelar */
ย ย ย ย .existing-course-card.to-cancel {
ย ย ย ย ย ย opacity: 0.6;
ย ย ย ย ย ย border: 2px dashed #dc2626;
ย ย ย ย }
ย ย ย ย .course-status-badge { /* Estilo bรกsico */
ย ย ย ย ย ย display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold;
ย ย ย ย }
ย ย ย ย .badge-active { background-color: #d1fae5; color: #065f46; }
ย ย ย ย .existing-course-card {
ย ย ย ย ย ย padding: 16px; margin-bottom: 12px; border: 1px solid #e5e7eb; border-radius: 6px;
ย ย ย ย }
ย ย ย ย .course-title { font-weight: bold; font-size: 16px; margin-bottom: 8px; }
ย ย ย ย .course-info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 14px; color: #4b5563; margin-bottom: 12px; }
ย ย ย ย .course-folio { font-size: 14px; margin-bottom: 12px; }
ย ย ย ย .course-actions button { padding: 8px 12px; border-radius: 4px; cursor: pointer; margin-right: 8px; }
ย ย ย ย .btn-cancel-course { background-color: #fef2f2; color: #b91c1c; border: 1px solid #fca5a5; }
ย ย ย ย .btn-keep-course { background-color: #eff6ff; color: #1d4ed8; border: 1px solid #93c5fd; }
ย ย ย ย .no-courses-message { text-align: center; padding: 20px; border: 1px dashed #d1d5db; border-radius: 6px; }
ย ย ย ย #actionSummary { background-color: #fef9e7; padding: 10px; border-radius: 6px; margin-top: 15px; }
ย ย ย ย #changesList { list-style: none; padding: 0; margin-top: 5px; }
ย ย ย ย #changesList .cancel { color: #dc2626; font-weight: bold; }
ย ย </style>

ย ย ย ย <script async src="https://www.googletagmanager.com/gtag/js?id=G-JH1X2720VL"></script>
ย ย <script>
ย ย ย window.dataLayer = window.dataLayer || [];
ย ย ย function gtag(){dataLayer.push(arguments);}
ย ย ย gtag('js', new Date());
ย ย ย gtag('config', 'G-JH1X2720VL');
ย ย </script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

ย ย ย ย <header class="bg-white shadow-md">
ย ย ย ย <div class="container mx-auto px-4 sm:px-6 lg:px-8">
ย ย ย ย ย ย <div class="flex items-center justify-between gap-4 py-4 min-h-[100px]">
ย ย ย ย ย ย ย ย <div class="flex-shrink-0">
ย ย ย ย ย ย ย ย ย ย <img class="h-16 md:h-20 lg:h-24" src="https://raw.githubusercontent.com/DA-itd/web/main/TecNM_logo.jpg" alt="Logo TecNM">
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="text-center flex-1 px-2">
ย ย ย ย ย ย ย ย ย ย <h1 class="text-base sm:text-lg md:text-xl lg:text-2xl font-bold text-blue-900">
ย ย ย ย ย ย ย ย ย ย ย ย SISTEMA DE INSCRIPCIรN A CURSOS DE ACTUALIZACIรN DOCENTE
ย ย ย ย ย ย ย ย ย ย </h1>
ย ย ย ย ย ย ย ย ย ย <h2 class="text-sm sm:text-base md:text-lg text-blue-900 mt-1">
ย ย ย ย ย ย ย ย ย ย ย ย INSTITUTO TECNOLรGICO DE DURANGO
ย ย ย ย ย ย ย ย ย ย </h2>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="flex-shrink-0">
ย ย ย ย ย ย ย ย ย ย <img class="h-16 md:h-20 lg:h-24" src="https://raw.githubusercontent.com/DA-itd/web/main/logo_itdurango.png" alt="Logo Instituto Tecnolรณgico de Durango">
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </header>

ย ย ย ย <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-grow">
ย ย ย ย ย ย ย ย <div class="bg-white p-6 rounded-lg shadow-lg max-w-lg mx-auto mb-8" id="curpSearchSection">
ย ย ย ย ย ย <h3 class="text-xl font-semibold mb-4 text-gray-800">1. Ingresa tu CURP</h3>
ย ย ย ย ย ย <div class="flex flex-col sm:flex-row gap-4">
ย ย ย ย ย ย ย ย <input type="text" id="curpInput" placeholder="CURP (18 caracteres)" maxlength="18"
ย ย ย ย ย ย ย ย ย ย class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 uppercase">
ย ย ย ย ย ย ย ย <button onclick="lookupUser()"
ย ย ย ย ย ย ย ย ย ย class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-150">
ย ย ย ย ย ย ย ย ย ย Buscar
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย </div>
ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div id="root">
ย ย ย ย ย ย ย ย ย ย ย ย <div id="catalogSection" style="display: none;">
ย ย ย ย ย ย ย ย <h3 class="text-xl font-semibold mb-4 text-gray-800">2. Catรกlogo de Cursos (Actualmente Oculto)</h3>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div id="loadingMessage" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden" style="z-index: 1001;">
ย ย ย ย ย ย <div class="bg-white p-6 rounded-lg shadow-xl">
ย ย ย ย ย ย ย ย <p id="loadingText" class="font-semibold text-blue-600">Cargando...</p>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </main>

ย ย ย ย <div id="existingCoursesModal" class="modal">
ย ย ย ย <div class="modal-content w-full max-w-4xl">
ย ย ย ย ย ย <h3 class="text-2xl font-bold mb-4 text-blue-800">Cursos de <span id="userName">Usuario</span> ya Inscritos</h3>
ย ย ย ย ย ย <p class="mb-4 text-gray-700">Parece que ya tienes cursos inscritos. Puedes **mantenerlos** o **cancelar** los que desees para inscribirte a otros.</p>
ย ย ย ย ย ย
ย ย ย ย ย ย <div id="existingCoursesList" class="my-6">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div id="actionSummary" class="p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800" style="display: none;">
ย ย ย ย ย ย ย ย <p class="font-bold">Resumen de Acciones:</p>
ย ย ย ย ย ย ย ย <ul id="changesList" class="list-disc ml-5 mt-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </ul>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div class="flex justify-end mt-6 space-x-4">
ย ย ย ย ย ย ย ย <button onclick="closeExistingModal()" class="py-2 px-4 bg-gray-300 text-gray-800 rounded hover:bg-gray-400">
ย ย ย ย ย ย ย ย ย ย Volver a Buscar
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย <button onclick="continueToNewCourses()" class="py-2 px-4 bg-green-600 text-white rounded hover:bg-green-700 font-bold">
ย ย ย ย ย ย ย ย ย ย Continuar al Catรกlogo (y Aplicar Cambios)
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย ย ย <div id="confirmCancelModal" class="modal">
ย ย ย ย <div class="modal-content w-full max-w-sm text-center">
ย ย ย ย ย ย <div class="text-4xl text-red-500 mb-4">โ๏ธ</div>
ย ย ย ย ย ย <h4 class="text-xl font-semibold mb-2 text-gray-800">ยฟEstรกs seguro de cancelar?</h4>
ย ย ย ย ย ย <p class="text-sm text-gray-600 mb-4">La cancelaciรณn de este curso es irreversible una vez que presiones "Continuar al Catรกlogo".</p>
ย ย ย ย ย ย
ย ย ย ย ย ย <div id="courseToCancel" class="bg-gray-100 p-3 rounded mb-6">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div class="flex justify-center space-x-4">
ย ย ย ย ย ย ย ย <button onclick="closeConfirmModal()" class="py-2 px-4 bg-gray-300 text-gray-800 rounded hover:bg-gray-400">
ย ย ย ย ย ย ย ย ย ย No, Mantener Curso
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย <button id="btnConfirmCancel" class="py-2 px-4 bg-red-600 text-white rounded hover:bg-red-700 font-bold">
ย ย ย ย ย ย ย ย ย ย Sรญ, Cancelar
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย ย ย <footer class="bg-blue-800 text-white text-center p-4 mt-auto">
ย ย ย ย <p class="font-semibold text-sm sm:text-base">ยฉ Coordinaciรณn de actualizaciรณn docente - M.C. Alejandro Calderรณn Renterรญa.</p>
ย ย ย ย <p class="text-xs sm:text-sm">Todos los derechos reservados <span id="copyright-year"></span>.</p>
ย ย </footer>

ย ย ย ย ย ย ย ย <script>
ย ย ย ย window.CONFIG = {
ย ย ย ย ย ย // ๐ REEMPLACE ESTA URL CON LA URL DE SU GOOGLE APPS SCRIPT
ย ย ย ย ย ย APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbwFO97VhIEO2ke2p-ZvYpXMWHP_LAxqmR0U5CmhPvOoQAH24FUAOt2rqGtoUhU-MKQauw/exec'
ย ย ย ย };

ย ย ย ย // La variable global WEBAPP_URL usa la URL definida en CONFIG
ย ย ย ย const WEBAPP_URL = window.CONFIG.APPS_SCRIPT_URL; // Asegura que la variable estรฉ disponible para el script

ย ย ย ย // ============================================
ย ย ย ย // VARIABLES GLOBALES
ย ย ย ย // ============================================
ย ย ย ย let currentUserData = null;
ย ย ย ย let existingCourses = [];
ย ย ย ย let coursesToCancel = [];
ย ย ย ย let coursesToKeep = [];

ย ย ย ย // ============================================
ย ย ย ย // FUNCIรN PRINCIPAL: Buscar por CURP
ย ย ย ย // ============================================
ย ย ย ย async function lookupUser() {
ย ย ย ย ย const curpInput = document.getElementById('curpInput');
ย ย ย ย ย const curp = curpInput.value.trim().toUpperCase();
ย ย ย ย ย
ย ย ย ย ย if (curp.length !== 18) {
ย ย ย ย ย ย showAlert('Por favor ingresa un CURP vรกlido de 18 caracteres', 'error');
ย ย ย ย ย ย return;
ย ย ย ย ย }
ย ย ย ย ย
ย ย ย ย ย showLoading('Buscando informaciรณn...');
ย ย ย ย ย
ย ย ย ย ย try {
ย ย ย ย ย ย const response = await fetch(`${WEBAPP_URL}?action=lookupByCurp&curp=${encodeURIComponent(curp)}`);
ย ย ย ย ย ย const result = await response.json();
ย ย ย ย ย ย
ย ย ย ย ย ย hideLoading();
ย ย ย ย ย ย
ย ย ย ย ย ย if (result.success && result.data) {
ย ย ย ย ย ย ย currentUserData = result.data.userData;
ย ย ย ย ย ย ย existingCourses = result.data.courseDetails || [];
ย ย ย ย ย ย ย
ย ย ย ย ย ย ย if (result.data.hasActiveEnrollments && existingCourses.length > 0) {
ย ย ย ย ย ย ย ย // Tiene cursos inscritos โ Mostrar modal
ย ย ย ย ย ย ย ย showExistingCoursesModal();
ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย // No tiene cursos โ Ir directo al catรกlogo
ย ย ย ย ย ย ย ย showCourseCatalog();
ย ย ย ย ย ย ย }
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย showAlert('No se encontrรณ informaciรณn. Verifica tu CURP.', 'warning');
ย ย ย ย ย ย }
ย ย ย ย ย ย
ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย hideLoading();
ย ย ย ย ย ย showAlert('Error de conexiรณn: ' + error.message, 'error');
ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย // ============================================
ย ย ย ย // MOSTRAR MODAL DE CURSOS EXISTENTES
ย ย ย ย // ============================================
ย ย ย ย function showExistingCoursesModal() {
ย ย ย ย ย const modal = document.getElementById('existingCoursesModal');
ย ย ย ย ย const listContainer = document.getElementById('existingCoursesList');
ย ย ย ย ย const userNameSpan = document.getElementById('userName');
ย ย ย ย ย
ย ย ย ย ย // Resetear listas
ย ย ย ย ย coursesToCancel = [];
ย ย ย ย ย coursesToKeep = [...existingCourses.map(c => c.courseId)];
ย ย ย ย ย
ย ย ย ย ย // Mostrar nombre del usuario
ย ย ย ย ย if (currentUserData && currentUserData.fullName) {
ย ย ย ย ย ย userNameSpan.textContent = currentUserData.fullName.split(' ')[0]; // Solo primer nombre
ย ย ย ย ย } else {
ย ย ย ย ย ย userNameSpan.textContent = 'Usuario';
ย ย ย ย ย }
ย ย ย ย ย
ย ย ย ย ย // Generar tarjetas de cursos
ย ย ย ย ย let html = '';
ย ย ย ย ย
ย ย ย ย ย if (existingCourses.length === 0) {
ย ย ย ย ย ย html = `
ย ย ย ย ย ย ย <div class="no-courses-message">
ย ย ย ย ย ย ย ย <div class="icon">๐</div>
ย ย ย ย ย ย ย ย <p>No tienes cursos inscritos actualmente.</p>
ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย `;
ย ย ย ย ย } else {
ย ย ย ย ย ย existingCourses.forEach((course, index) => {
ย ย ย ย ย ย ย html += `
ย ย ย ย ย ย ย ย <div class="existing-course-card" id="courseCard_${index}" data-course-id="${course.courseId}">
ย ย ย ย ย ย ย ย ย <span class="course-status-badge badge-active">โ INSCRITO</span>
ย ย ย ย ย ย ย ย ย
ย ย ย ย ย ย ย ย ย <div class="course-title">${course.courseName}</div>
ย ย ย ย ย ย ย ย ย
ย ย ย ย ย ย ย ย ย <div class="course-info-grid">
ย ย ย ย ย ย ย ย ย ย <div class="course-info-item">๐ ${course.dates}</div>
ย ย ย ย ย ย ย ย ย ย <div class="course-info-item">โฐ ${course.schedule}</div>
ย ย ย ย ย ย ย ย ย ย <div class="course-info-item">๐ ${course.location || 'Por definir'}</div>
ย ย ย ย ย ย ย ย ย ย <div class="course-info-item">โฑ๏ธ ${course.hours} horas</div>
ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย
ย ย ย ย ย ย ย ย ย <div class="course-folio">
ย ย ย ย ย ย ย ย ย ย <strong>Folio:</strong> ${course.folio}
ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย
ย ย ย ย ย ย ย ย ย <div class="course-actions">
ย ย ย ย ย ย ย ย ย ย <button class="btn-cancel-course" onclick="markForCancel(${index})">
ย ย ย ย ย ย ย ย ย ย ย โ Cancelar inscripciรณn
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย <button class="btn-keep-course" onclick="markToKeep(${index})" style="display: none;">
ย ย ย ย ย ย ย ย ย ย ย โ Mantener curso
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย `;
ย ย ย ย ย ย });
ย ย ย ย ย }
ย ย ย ย ย
ย ย ย ย ย listContainer.innerHTML = html;
ย ย ย ย ย updateActionSummary();
ย ย ย ย ย modal.style.display = 'flex';
ย ย ย ย }

ย ย ย ย // ============================================
ย ย ย ย // MARCAR CURSO PARA CANCELAR
ย ย ย ย // ============================================
ย ย ย ย function markForCancel(index) {
ย ย ย ย ย const course = existingCourses[index];
ย ย ย ย ย const card = document.getElementById(`courseCard_${index}`);
ย ย ย ย ย
ย ย ย ย ย // Mostrar modal de confirmaciรณn
ย ย ย ย ย const confirmModal = document.getElementById('confirmCancelModal');
ย ย ย ย ย const courseInfo = document.getElementById('courseToCancel');
ย ย ย ย ย
ย ย ย ย ย courseInfo.innerHTML = `
ย ย ย ย ย ย <div class="name">${course.courseName}</div>
ย ย ย ย ย ย <div style="font-size: 13px; color: #6b7280; margin-top: 8px;">
ย ย ย ย ย ย ย ๐ ${course.dates} | โฐ ${course.schedule}<br>
ย ย ย ย ย ย ย ๐ซ Folio: ${course.folio}
ย ย ย ย ย ย </div>
ย ย ย ย ย `;
ย ย ย ย ย
ย ย ย ย ย document.getElementById('btnConfirmCancel').onclick = () => {
ย ย ย ย ย ย // Confirmar cancelaciรณn
ย ย ย ย ย ย card.classList.add('to-cancel');
ย ย ย ย ย ย
ย ย ย ย ย ย // Cambiar botones
ย ย ย ย ย ย card.querySelector('.btn-cancel-course').style.display = 'none';
ย ย ย ย ย ย card.querySelector('.btn-keep-course').style.display = 'block';
ย ย ย ย ย ย
ย ย ย ย ย ย // Actualizar listas
ย ย ย ย ย ย if (!coursesToCancel.includes(course.courseId)) {
ย ย ย ย ย ย ย coursesToCancel.push(course.courseId);
ย ย ย ย ย ย }
ย ย ย ย ย ย coursesToKeep = coursesToKeep.filter(id => id !== course.courseId);
ย ย ย ย ย ย
ย ย ย ย ย ย updateActionSummary();
ย ย ย ย ย ย closeConfirmModal();
ย ย ย ย ย };
ย ย ย ย ย
ย ย ย ย ย confirmModal.style.display = 'flex';
ย ย ย ย }

ย ย ย ย // ============================================
ย ย ย ย // MARCAR CURSO PARA MANTENER (deshacer cancelaciรณn)
ย ย ย ย // ============================================
ย ย ย ย function markToKeep(index) {
ย ย ย ย ย const course = existingCourses[index];
ย ย ย ย ย const card = document.getElementById(`courseCard_${index}`);
ย ย ย ย ย
ย ย ย ย ย card.classList.remove('to-cancel');
ย ย ย ย ย
ย ย ย ย ย // Cambiar botones
ย ย ย ย ย card.querySelector('.btn-cancel-course').style.display = 'block';
ย ย ย ย ย card.querySelector('.btn-keep-course').style.display = 'none';
ย ย ย ย ย
ย ย ย ย ย // Actualizar listas
ย ย ย ย ย coursesToCancel = coursesToCancel.filter(id => id !== course.courseId);
ย ย ย ย ย if (!coursesToKeep.includes(course.courseId)) {
ย ย ย ย ย ย coursesToKeep.push(course.courseId);
ย ย ย ย ย }
ย ย ย ย ย
ย ย ย ย ย updateActionSummary();
ย ย ย ย }

ย ย ย ย // ============================================
ย ย ย ย // ACTUALIZAR RESUMEN DE ACCIONES
ย ย ย ย // ============================================
ย ย ย ย function updateActionSummary() {
ย ย ย ย ย const summary = document.getElementById('actionSummary');
ย ย ย ย ย const list = document.getElementById('changesList');
ย ย ย ย ย
ย ย ย ย ย if (coursesToCancel.length === 0) {
ย ย ย ย ย ย summary.style.display = 'none';
ย ย ย ย ย ย return;
ย ย ย ย ย }
ย ย ย ย ย
ย ย ย ย ย summary.style.display = 'block';
ย ย ย ย ย
ย ย ย ย ย let html = '';
ย ย ย ย ย coursesToCancel.forEach(courseId => {
ย ย ย ย ย ย const course = existingCourses.find(c => c.courseId === courseId);
ย ย ย ย ย ย if (course) {
ย ย ย ย ย ย ย html += `<li class="cancel">โ Se cancelarรก: ${course.courseName}</li>`;
ย ย ย ย ย ย }
ย ย ย ย ย });
ย ย ย ย ย
ย ย ย ย ย list.innerHTML = html;
ย ย ย ย }

ย ย ย ย // ============================================
ย ย ย ย // CERRAR MODALES
ย ย ย ย // ============================================
ย ย ย ย function closeExistingModal() {
ย ย ย ย ย document.getElementById('existingCoursesModal').style.display = 'none';
ย ย ย ย }

ย ย ย ย function closeConfirmModal() {
ย ย ย ย ย document.getElementById('confirmCancelModal').style.display = 'none';
ย ย ย ย }

ย ย ย ย // ============================================
ย ย ย ย // CONTINUAR A SELECCIรN DE CURSOS NUEVOS
ย ย ย ย // ============================================
ย ย ย ย async function continueToNewCourses() {
ย ย ย ย ย // Si hay cursos para cancelar, procesarlos primero
ย ย ย ย ย if (coursesToCancel.length > 0) {
ย ย ย ย ย ย showLoading('Procesando cancelaciones...');
ย ย ย ย ย ย
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย const response = await fetch(WEBAPP_URL, {
ย ย ย ย ย ย ย ย method: 'POST',
ย ย ย ย ย ย ย ย headers: { 'Content-Type': 'application/json' },
ย ย ย ย ย ย ย ย body: JSON.stringify({
ย ย ย ย ย ย ย ย ย action: 'cancelSelectedCourses',
ย ย ย ย ย ย ย ย ย curp: document.getElementById('curpInput').value.trim().toUpperCase(),
ย ย ย ย ย ย ย ย ย courseIds: coursesToCancel,
ย ย ย ย ย ย ย ย ย email: currentUserData?.email,
ย ย ย ย ย ย ย ย ย fullName: currentUserData?.fullName
ย ย ย ย ย ย ย ย })
ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย
ย ย ย ย ย ย ย const result = await response.json();
ย ย ย ย ย ย ย hideLoading();
ย ย ย ย ย ย ย
ย ย ย ย ย ย ย if (result.success) {
ย ย ย ย ย ย ย ย showAlert(`Se cancelaron ${result.cancelledCount} curso(s). Recibirรกs confirmaciรณn por correo.`, 'success');
ย ย ย ย ย ย ย ย
ย ย ย ย ย ย ย ย // Actualizar lista de cursos existentes (remover los cancelados)
ย ย ย ย ย ย ย ย existingCourses = existingCourses.filter(c => !coursesToCancel.includes(c.courseId));
ย ย ย ย ย ย ย ย coursesToCancel = [];
ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย showAlert('Error al cancelar: ' + result.message, 'error');
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย hideLoading();
ย ย ย ย ย ย ย showAlert('Error de conexiรณn: ' + error.message, 'error');
ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }
ย ย ย ย ย }
ย ย ย ย ย
ย ย ย ย ย closeExistingModal();
ย ย ย ย ย
ย ย ย ย ย // Mostrar catรกlogo de cursos
ย ย ย ย ย // Pasar los cursos que mantiene para validar empalmes
ย ย ย ย ย showCourseCatalog(coursesToKeep);
ย ย ย ย }

ย ย ย ย // ============================================
ย ย ย ย // MOSTRAR CATรLOGO DE CURSOS
ย ย ย ย // ============================================
ย ย ย ย function showCourseCatalog(keptCourseIds = []) {
ย ย ย ย ย // Aquรญ va tu cรณdigo actual para mostrar el catรกlogo
ย ย ย ย ย // Los cursos en keptCourseIds ya estรกn inscritos
ย ย ย ย ย
ย ย ย ย ย console.log('Cursos que mantiene:', keptCourseIds);
ย ย ย ย ย console.log('Cursos existentes para validar empalmes:', 
ย ย ย ย ย ย existingCourses.filter(c => keptCourseIds.includes(c.courseId))
ย ย ย ย ย );
ย ย ย ย ย
ย ย ย ย ย // Muestra tu formulario/catรกlogo aquรญ
ย ย ย ย ย document.getElementById('catalogSection').style.display = 'block';
ย ย ย ย ย document.getElementById('curpSearchSection').style.display = 'none'; // Ocultar bรบsqueda
ย ย ย ย }

ย ย ย ย // ============================================
ย ย ย ย // FUNCIONES AUXILIARES
ย ย ย ย // (Implementaciones mรญnimas para evitar errores)
ย ย ย ย // ============================================
ย ย ย ย function showLoading(message = 'Cargando...') {
ย ย ย ย ย const loadingDiv = document.getElementById('loadingMessage');
ย ย ย ย ย document.getElementById('loadingText').textContent = message;
ย ย ย ย ย loadingDiv.classList.remove('hidden');
ย ย ย ย }

ย ย ย ย function hideLoading() {
ย ย ย ย ย document.getElementById('loadingMessage').classList.add('hidden');
ย ย ย ย }

ย ย ย ย function showAlert(message, type = 'info') {
ย ย ย ย ย let icon = 'โน๏ธ';
ย ย ย ย ย if (type === 'error') icon = 'โ';
ย ย ย ย ย if (type === 'warning') icon = 'โ๏ธ';
ย ย ย ย ย if (type === 'success') icon = 'โ';
ย ย ย ย ย alert(`${icon} ${message}`); // Usando la funciรณn nativa alert por simplicidad
ย ย ย ย }
ย ย </script>

ย ย ย ย ย ย <script>
ย ย ย ย document.addEventListener('DOMContentLoaded', () => {
ย ย ย ย ย ย const yearSpan = document.getElementById('copyright-year');
ย ย ย ย ย ย if (yearSpan) {
ย ย ย ย ย ย ย ย yearSpan.textContent = new Date().getFullYear();
ย ย ย ย ย ย }
ย ย ย ย });
ย ย </script>
</body>
</html>